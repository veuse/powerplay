(function(e,t,n,r){"use strict";Foundation.libs.interchange={name:"interchange",version:"5.2.1",cache:{},images_loaded:false,nodes_loaded:false,settings:{load_attr:"interchange",named_queries:{"default":"only screen",small:Foundation.media_queries.small,medium:Foundation.media_queries.medium,large:Foundation.media_queries.large,xlarge:Foundation.media_queries.xlarge,xxlarge:Foundation.media_queries.xxlarge,landscape:"only screen and (orientation: landscape)",portrait:"only screen and (orientation: portrait)",retina:"only screen and (-webkit-min-device-pixel-ratio: 2),"+"only screen and (min--moz-device-pixel-ratio: 2),"+"only screen and (-o-min-device-pixel-ratio: 2/1),"+"only screen and (min-device-pixel-ratio: 2),"+"only screen and (min-resolution: 192dpi),"+"only screen and (min-resolution: 2dppx)"},directives:{replace:function(t,n,r){if(/IMG/.test(t[0].nodeName)){var i=t[0].src;if((new RegExp(n,"i")).test(i))return;t[0].src=n;return r(t[0].src)}var s=t.data(this.data_attr+"-last-path");if(s==n)return;if(/\.(gif|jpg|jpeg|tiff|png)([?#].*)?/i.test(n)){e(t).css("background-image","url("+n+")");t.data("interchange-last-path",n);return r(n)}return e.get(n,function(e){t.html(e);t.data(this.data_attr+"-last-path",n);r()})}}},init:function(t,n,r){Foundation.inherit(this,"throttle random_str");this.data_attr=this.set_data_attr();e.extend(true,this.settings,n,r);this.bindings(n,r);this.load("images");this.load("nodes")},get_media_hash:function(){var e="";for(var t in this.settings.named_queries){e+=matchMedia(this.settings.named_queries[t]).matches.toString()}return e},events:function(){var n=this,r;e(t).off(".interchange").on("resize.fndtn.interchange",n.throttle(function(){var e=n.get_media_hash();if(e!==r){n.resize()}r=e},50));return this},resize:function(){var t=this.cache;if(!this.images_loaded||!this.nodes_loaded){setTimeout(e.proxy(this.resize,this),50);return}for(var n in t){if(t.hasOwnProperty(n)){var r=this.results(n,t[n]);if(r){this.settings.directives[r.scenario[1]].call(this,r.el,r.scenario[0],function(){if(arguments[0]instanceof Array){var e=arguments[0]}else{var e=Array.prototype.slice.call(arguments,0)}r.el.trigger(r.scenario[1],e)})}}}},results:function(e,t){var n=t.length;if(n>0){var r=this.S("["+this.add_namespace("data-uuid")+'="'+e+'"]');while(n--){var i,s=t[n][2];if(this.settings.named_queries.hasOwnProperty(s)){i=matchMedia(this.settings.named_queries[s])}else{i=matchMedia(s)}if(i.matches){return{el:r,scenario:t[n]}}}}return false},load:function(e,t){if(typeof this["cached_"+e]==="undefined"||t){this["update_"+e]()}return this["cached_"+e]},update_images:function(){var e=this.S("img["+this.data_attr+"]"),t=e.length,n=t,r=0,i=this.data_attr;this.cache={};this.cached_images=[];this.images_loaded=t===0;while(n--){r++;if(e[n]){var s=e[n].getAttribute(i)||"";if(s.length>0){this.cached_images.push(e[n])}}if(r===t){this.images_loaded=true;this.enhance("images")}}return this},update_nodes:function(){var e=this.S("["+this.data_attr+"]").not("img"),t=e.length,n=t,r=0,i=this.data_attr;this.cached_nodes=[];this.nodes_loaded=t===0;while(n--){r++;var s=e[n].getAttribute(i)||"";if(s.length>0){this.cached_nodes.push(e[n])}if(r===t){this.nodes_loaded=true;this.enhance("nodes")}}return this},enhance:function(n){var r=this["cached_"+n].length;while(r--){this.object(e(this["cached_"+n][r]))}return e(t).trigger("resize")},parse_params:function(e,t,n){return[this.trim(e),this.convert_directive(t),this.trim(n)]},convert_directive:function(e){var t=this.trim(e);if(t.length>0){return t}return"replace"},object:function(e){var t=this.parse_data_attr(e),n=[],r=t.length;if(r>0){while(r--){var i=t[r].split(/\((.*?)(\))$/);if(i.length>1){var s=i[0].split(","),o=this.parse_params(s[0],s[1],i[1]);n.push(o)}}}return this.store(e,n)},store:function(e,t){var n=this.random_str(),r=e.data(this.add_namespace("uuid",true));if(this.cache[r])return this.cache[r];e.attr(this.add_namespace("data-uuid"),n);return this.cache[n]=t},trim:function(t){if(typeof t==="string"){return e.trim(t)}return t},set_data_attr:function(e){if(e){if(this.namespace.length>0){return this.namespace+"-"+this.settings.load_attr}return this.settings.load_attr}if(this.namespace.length>0){return"data-"+this.namespace+"-"+this.settings.load_attr}return"data-"+this.settings.load_attr},parse_data_attr:function(e){var t=e.attr(this.attr_name()).split(/\[(.*?)\]/),n=t.length,r=[];while(n--){if(t[n].replace(/[\W\d]+/,"").length>4){r.push(t[n])}}return r},reflow:function(){this.load("images",true);this.load("nodes",true)}}})(jQuery,this,this.document)